<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>VectorBid Admin Login</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            rel="stylesheet"
        />
    </head>
    <body class="bg-light">
        <div class="container">
            <div class="row justify-content-center mt-5">
                <div class="col-md-6 col-lg-4">
                    <div class="card shadow">
                        <div class="card-body p-4">
                            <div class="text-center mb-4">
                                <i
                                    class="fas fa-plane fa-3x text-primary mb-3"
                                ></i>
                                <h2 class="text-dark">VectorBid Admin</h2>
                                <p class="text-muted">
                                    Enter your admin token to continue
                                </p>
                            </div>

                            {% if error %}
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle me-2"></i
                                >{{ error }}
                            </div>
                            {% endif %}

                            <form id="loginForm" method="POST">
                                <div class="mb-3">
                                    <label for="token" class="form-label"
                                        >Admin Token</label
                                    >
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fas fa-key"></i>
                                        </span>
                                        <input
                                            type="password"
                                            class="form-control"
                                            id="token"
                                            name="token"
                                            placeholder="Enter your admin token"
                                            required
                                        />
                                    </div>
                                </div>

                                <div class="d-grid">
                                    <button
                                        type="submit"
                                        class="btn btn-primary"
                                        id="loginBtn"
                                    >
                                        <i class="fas fa-sign-in-alt me-2"></i>
                                        Access Admin Dashboard
                                    </button>
                                </div>
                            </form>

                            <div id="loginMessage" class="mt-3"></div>

                            <div class="text-center mt-4">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Need your admin token? Check your Replit
                                    Secrets for ADMIN_TOKEN
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            document
                .getElementById("loginForm")
                .addEventListener("submit", async function (e) {
                    e.preventDefault();

                    const token = document.getElementById("token").value;
                    const messageDiv = document.getElementById("loginMessage");
                    const loginBtn = document.getElementById("loginBtn");

                    if (!token) {
                        messageDiv.innerHTML =
                            '<div class="alert alert-warning">Please enter your admin token</div>';
                        return;
                    }

                    try {
                        // Show loading state
                        loginBtn.disabled = true;
                        loginBtn.innerHTML =
                            '<i class="fas fa-spinner fa-spin me-2"></i>Logging in...';
                        messageDiv.innerHTML =
                            '<div class="alert alert-info">Verifying token...</div>';

                        // Send login request
                        const response = await fetch("/admin/login", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({ token: token }),
                        });

                        const result = await response.json();

                        if (response.ok && result.success) {
                            messageDiv.innerHTML =
                                '<div class="alert alert-success">Login successful! Redirecting to dashboard...</div>';

                            // Redirect to dashboard
                            setTimeout(() => {
                                window.location.href =
                                    result.redirect || "/admin/dashboard";
                            }, 1000);
                        } else {
                            throw new Error(result.error || "Login failed");
                        }
                    } catch (error) {
                        console.error("Login error:", error);
                        messageDiv.innerHTML = `<div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Login failed: ${error.message}
                </div>`;

                        // Reset button
                        loginBtn.disabled = false;
                        loginBtn.innerHTML =
                            '<i class="fas fa-sign-in-alt me-2"></i>Access Admin Dashboard';
                    }
                });

            // Simple fallback: allow form submission if JavaScript fails
            document.getElementById("loginForm").onsubmit = function () {
                if (!this.querySelector("#token").value) {
                    alert("Please enter your admin token");
                    return false;
                }
                return true;
            };
        </script>
    </body>
</html>
