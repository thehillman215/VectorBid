<div class="step-content">
    <h3 class="text-center mb-4">
        <i class="fas fa-masks-theater text-primary me-2"></i>
        Step 4: Choose Your Flying Style
    </h3>
    
    {% if error %}
        <div class="alert alert-danger" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>{{ error }}
        </div>
    {% endif %}

    <p class="text-muted text-center mb-4">
        Select a persona that matches your flying preferences, or create your own custom profile.
    </p>

    <form hx-post="{{ url_for('welcome.wizard_step', step=4) }}" 
          hx-target="#wizard-content" 
          hx-swap="innerHTML">
        
        <!-- Persona Cards -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card persona-card {{ 'selected' if wizard_data and wizard_data.persona == 'work_life_balance' }}" onclick="selectPersona('work_life_balance')">
                    <div class="card-body text-center">
                        <i class="fas fa-balance-scale fa-3x text-primary mb-3"></i>
                        <h5 class="card-title">Work-Life Balance</h5>
                        <p class="card-text text-muted small">
                            Prioritizes weekends off, shorter trips, and predictable schedules. 
                            Values time at home and regular family time.
                        </p>
                        <input type="radio" name="persona" value="work_life_balance" 
                               {{ 'checked' if wizard_data and wizard_data.persona == 'work_life_balance' }}>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-3">
                <div class="card persona-card {{ 'selected' if wizard_data and wizard_data.persona == 'credit_hunter' }}" onclick="selectPersona('credit_hunter')">
                    <div class="card-body text-center">
                        <i class="fas fa-coins fa-3x text-primary mb-3"></i>
                        <h5 class="card-title">Credit Hunter</h5>
                        <p class="card-text text-muted small">
                            Maximizes flight hours and earnings. Prefers longer trips, 
                            overtime opportunities, and high-credit sequences.
                        </p>
                        <input type="radio" name="persona" value="credit_hunter"
                               {{ 'checked' if wizard_data and wizard_data.persona == 'credit_hunter' }}>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-3">
                <div class="card persona-card {{ 'selected' if wizard_data and wizard_data.persona == 'adventure_seeker' }}" onclick="selectPersona('adventure_seeker')">
                    <div class="card-body text-center">
                        <i class="fas fa-globe-americas fa-3x text-primary mb-3"></i>
                        <h5 class="card-title">Adventure Seeker</h5>
                        <p class="card-text text-muted small">
                            Loves international routes, new destinations, and longer layovers. 
                            Values travel experiences and exploring new places.
                        </p>
                        <input type="radio" name="persona" value="adventure_seeker"
                               {{ 'checked' if wizard_data and wizard_data.persona == 'adventure_seeker' }}>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6 mb-3">
                <div class="card persona-card {{ 'selected' if wizard_data and wizard_data.persona == 'commuter_friendly' }}" onclick="selectPersona('commuter_friendly')">
                    <div class="card-body text-center">
                        <i class="fas fa-plane-departure fa-3x text-primary mb-3"></i>
                        <h5 class="card-title">Commuter Friendly</h5>
                        <p class="card-text text-muted small">
                            Optimizes for easy commute patterns, predictable start times, 
                            and trips that work well with commuting schedules.
                        </p>
                        <input type="radio" name="persona" value="commuter_friendly"
                               {{ 'checked' if wizard_data and wizard_data.persona == 'commuter_friendly' }}>
                    </div>
                </div>
            </div>
        </div>

        <!-- Custom Persona Option -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="form-check mb-3">
                    <input class="form-check-input" type="radio" name="persona" value="custom" id="custom_persona"
                           {{ 'checked' if wizard_data and wizard_data.persona == 'custom' }}
                           onchange="toggleCustomInput()">
                    <label class="form-check-label fw-semibold" for="custom_persona">
                        <i class="fas fa-edit text-primary me-2"></i>
                        Custom - Describe Your Own Preferences
                    </label>
                </div>
                
                <div id="custom_input" style="display: {{ 'block' if wizard_data and wizard_data.persona == 'custom' else 'none' }};">
                    <textarea class="form-control" name="custom_preferences" rows="4" 
                              placeholder="Describe your ideal flying schedule in your own words. For example: 'I want to maximize international flights but avoid red-eyes. I prefer 3-4 day trips with at least 24-hour layovers in interesting cities. Weekends off are important but not critical.'"
                              >{{ wizard_data.custom_preferences if wizard_data else '' }}</textarea>
                    <div class="form-text">
                        <i class="fas fa-info-circle text-primary me-1"></i>
                        Be specific about trip length, destinations, layover preferences, work-life balance priorities, etc.
                    </div>
                </div>
            </div>
        </div>

        <div class="d-grid">
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-check-circle me-2"></i>Complete Profile Setup
            </button>
        </div>
    </form>
</div>

<style>
.persona-card {
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.persona-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.persona-card.selected {
    border-color: #667eea;
    background: rgba(102, 126, 234, 0.1);
}

.persona-card input[type="radio"] {
    display: none;
}
</style>

<script>
function selectPersona(persona) {
    // Clear all selections
    document.querySelectorAll('.persona-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    // Clear custom radio
    document.getElementById('custom_persona').checked = false;
    
    // Select the clicked persona
    event.currentTarget.classList.add('selected');
    event.currentTarget.querySelector('input[type="radio"]').checked = true;
    
    // Hide custom input
    document.getElementById('custom_input').style.display = 'none';
}

function toggleCustomInput() {
    const customInput = document.getElementById('custom_input');
    const isCustomSelected = document.getElementById('custom_persona').checked;
    
    if (isCustomSelected) {
        // Clear persona card selections
        document.querySelectorAll('.persona-card').forEach(card => {
            card.classList.remove('selected');
            card.querySelector('input[type="radio"]').checked = false;
        });
        
        customInput.style.display = 'block';
    } else {
        customInput.style.display = 'none';
    }
}
</script>