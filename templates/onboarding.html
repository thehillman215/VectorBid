<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to VectorBid - Setup</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        .onboarding-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .onboarding-card {
            background: var(--bs-body-bg);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            max-width: 600px;
            width: 100%;
            margin: 2rem;
        }
        .progress-bar-container {
            height: 6px;
            background: var(--bs-border-color);
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }
        .step-content {
            min-height: 300px;
        }
        .fleet-chip {
            display: inline-block;
            padding: 0.5rem 1rem;
            margin: 0.25rem;
            background: var(--bs-secondary);
            border: 2px solid transparent;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .fleet-chip:hover {
            background: var(--bs-primary);
            color: white;
        }
        .fleet-chip.selected {
            background: var(--bs-primary);
            color: white;
            border-color: var(--bs-primary);
        }
        .seat-option {
            background: var(--bs-secondary);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 2rem;
            text-center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .seat-option:hover {
            background: var(--bs-primary);
            color: white;
        }
        .seat-option.selected {
            background: var(--bs-primary);
            color: white;
            border-color: var(--bs-primary);
        }
    </style>
</head>
<body>
    <div class="onboarding-container">
        <div class="onboarding-card">
            <div class="card-header text-center py-4">
                <i class="fas fa-vector-square fa-3x text-primary mb-3"></i>
                <h2>Welcome to VectorBid</h2>
                <p class="text-muted">Let's set up your pilot profile</p>

                <!-- Progress Bar -->
                <div class="progress-bar-container mt-4">
                    <div class="progress-bar" style="width: {{ (step / 3 * 100) }}%"></div>
                </div>
                <div class="mt-2">
                    <small class="text-muted">Step {{ step }} of 3</small>
                </div>
            </div>

            <div class="card-body step-content">
                {% if step == 1 %}
                    <!-- Step 1: Airline, Base, Position -->
                    <form method="POST" action="{{ url_for('main.onboarding_submit') }}">
                        <input type="hidden" name="step" value="1">

                        <h4 class="mb-4"><i class="fas fa-plane me-2"></i>Basic Information</h4>

                        <div class="mb-4">
                            <label class="form-label">Airline</label>
                            <select class="form-select" name="airline" data-test-id="airline-select" required>
                                <option value="">Select your airline</option>
                                <option value="United" {{ 'selected' if profile.airline == 'United' }}>United Airlines</option>
                                <option value="Delta" {{ 'selected' if profile.airline == 'Delta' }}>Delta Air Lines</option>
                                <option value="Southwest" {{ 'selected' if profile.airline == 'Southwest' }}>Southwest Airlines</option>
                                <option value="Alaska" {{ 'selected' if profile.airline == 'Alaska' }}>Alaska Airlines</option>
                                <option value="Other" {{ 'selected' if profile.airline == 'Other' }}>Other</option>
                            </select>
                        </div>

                        <div class="mb-4">
                            <label class="form-label">Base</label>
                            <input type="text" class="form-control" name="base" data-test-id="base-input" 
                                   placeholder="e.g. IAH, DEN, LAX" value="{{ profile.base or '' }}" required>
                            <small class="form-text text-muted">Enter your home base airport code</small>
                        </div>

                        <div class="mb-4">
                            <label class="form-label">Position</label>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="seat-option {{ 'selected' if profile.seat == 'CA' }}" 
                                         data-test-id="captain-option" onclick="selectSeat('CA')">
                                        <i class="fas fa-user-tie fa-2x mb-2"></i>
                                        <h5>Captain</h5>
                                        <p class="text-muted mb-0">Left seat</p>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="seat-option {{ 'selected' if profile.seat == 'FO' }}" 
                                         data-test-id="first-officer-option" onclick="selectSeat('FO')">
                                        <i class="fas fa-user fa-2x mb-2"></i>
                                        <h5>First Officer</h5>
                                        <p class="text-muted mb-0">Right seat</p>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" name="seat" id="seat-input" data-test-id="seat-input" 
                                   value="{{ profile.seat or '' }}" required>
                        </div>

                        <div class="d-flex justify-content-end">
                            <button type="submit" class="btn btn-primary btn-lg" data-test-id="step1-submit-btn">
                                Next <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </form>

                {% elif step == 2 %}
                    <!-- Step 2: Fleet & Seniority -->
                    <form method="POST" action="{{ url_for('main.onboarding_submit') }}">
                        <input type="hidden" name="step" value="2">

                        <h4 class="mb-4"><i class="fas fa-plane-departure me-2"></i>Fleet & Experience</h4>

                        <div class="mb-4">
                            <label class="form-label">Aircraft Fleet</label>
                            <p class="text-muted">Select all aircraft types you're qualified on</p>
                            <div id="fleet-selection" data-test-id="fleet-selection">
                                {% for aircraft in ['737', '320', '757/767', '787', 'A350', 'A330', 'Other'] %}
                                    <span class="fleet-chip {{ 'selected' if aircraft in profile.fleet }}" 
                                          data-test-id="fleet-chip-{{ aircraft|replace('/', '-') }}"
                                          onclick="toggleFleet('{{ aircraft }}')">
                                        {{ aircraft }}
                                    </span>
                                {% endfor %}
                            </div>
                            <input type="hidden" name="fleet" id="fleet-input" data-test-id="fleet-input" 
                                   value="{{ profile.fleet|join(',') if profile.fleet }}">
                        </div>

                        <div class="mb-4">
                            <label class="form-label">Seniority Number</label>
                            <input type="number" class="form-control" name="seniority" data-test-id="seniority-input"
                                   placeholder="e.g. 1250" value="{{ profile.seniority or '' }}" required>
                            <small class="form-text text-muted">Your current seniority number at your airline</small>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('main.onboarding', step=1) }}" class="btn btn-outline-secondary" 
                               data-test-id="step2-back-btn">
                                <i class="fas fa-arrow-left me-2"></i>Back
                            </a>
                            <button type="submit" class="btn btn-primary btn-lg" data-test-id="step2-submit-btn">
                                Next <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </form>

                {% elif step == 3 %}
                    <!-- Step 3: Tour & Finish -->
                    <div class="text-center">
                        <h4 class="mb-4"><i class="fas fa-check-circle text-success me-2"></i>You're All Set!</h4>

                        <div class="row text-start mb-4">
                            <div class="col-md-6 mb-3">
                                <div class="p-3 border rounded">
                                    <h6><i class="fas fa-magic text-primary me-2"></i>AI-Powered Rankings</h6>
                                    <p class="text-muted mb-0">Get intelligent trip rankings based on your preferences</p>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="p-3 border rounded">
                                    <h6><i class="fas fa-calendar text-primary me-2"></i>Auto-Matching</h6>
                                    <p class="text-muted mb-0">We'll automatically find bid packages for your profile</p>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="p-3 border rounded">
                                    <h6><i class="fas fa-download text-primary me-2"></i>Export Results</h6>
                                    <p class="text-muted mb-0">Download your rankings as CSV for easy reference</p>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="p-3 border rounded">
                                    <h6><i class="fas fa-shield-alt text-primary me-2"></i>Secure & Private</h6>
                                    <p class="text-muted mb-0">Your data is processed securely and stored privately</p>
                                </div>
                            </div>
                        </div>

                        <form method="POST" action="{{ url_for('main.onboarding_submit') }}">
                            <input type="hidden" name="step" value="3">
                            <div class="d-flex justify-content-between">
                                <a href="{{ url_for('main.onboarding', step=2) }}" class="btn btn-outline-secondary"
                                   data-test-id="step3-back-btn">
                                    <i class="fas fa-arrow-left me-2"></i>Back
                                </a>
                                <button type="submit" class="btn btn-success btn-lg" data-test-id="step3-complete-btn">
                                    <i class="fas fa-rocket me-2"></i>Get Started!
                                </button>
                            </div>
                        </form>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function selectSeat(seat) {
            // Remove selected class from all options
            document.querySelectorAll('.seat-option').forEach(el => el.classList.remove('selected'));
            // Add selected class to clicked option
            event.currentTarget.classList.add('selected');
            // Update hidden input
            document.getElementById('seat-input').value = seat;
        }

        function toggleFleet(aircraft) {
            const element = event.currentTarget;
            element.classList.toggle('selected');

            // Update hidden input with selected aircraft
            const selected = Array.from(document.querySelectorAll('.fleet-chip.selected'))
                .map(el => el.textContent.trim());
            document.getElementById('fleet-input').value = selected.join(',');
        }
    </script>
</body>
</html>